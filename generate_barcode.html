<!DOCTYPE html>
<html>
<head>
  <title>Generate Barcode</title>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.2/dist/css/bootstrap.min.css">
  <link rel="stylesheet" href="style.css">
  <script src="https://cdn.jsdelivr.net/npm/jsbarcode@3.11.6/dist/JsBarcode.all.min.js"></script>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Sora:wght@300;400;500;600;700&display=swap" rel="stylesheet">
</head>
<body class="dashboard-page">
  <div class="crm-shell">
    <aside class="crm-sidebar">
      <a class="crm-brand crm-brand__link" href="index.html">
        <img src="image/LogoIPB.png" alt="Logo IPB">
        <div>
          <h2>Inventory CRM</h2>
          <span>Lab Komputer</span>
        </div>
      </a>
      <nav class="crm-nav">
        <a class="crm-nav__link" href="dashboard.html">Beranda</a>
        <a class="crm-nav__link active" href="data_barang.html">Data Barang</a>
        <a class="crm-nav__link" href="pinjam_alat.html">Peminjaman</a>
        <a class="crm-nav__link" href="chart.html">Laporan</a>
        <a class="crm-nav__link" href="tentang_kami.html">Tentang Kami</a>
      </nav></aside>

    <main class="crm-main">
      <header class="crm-topbar">
        <div>
          <h1>Generate Barcode</h1>
          <p>Cetak barcode untuk barang inventaris.</p>
        </div>
        <div class="crm-topbar__actions">
          <div class="crm-user">
            <span>Hi, <strong id="username">-</strong> (<button type="button" class="crm-user__logout" onclick="window.app.logout()">Logout</button>)</span>
          </div>
        </div>
      </header>

      <section class="crm-panel" style="text-align:center;">
        <h3>Barcode</h3>
        <svg id="barcode"></svg>
        <div class="mt-3">
          <button class="btn btn-primary" onclick="window.print()">Print</button>
        </div>
      </section>
    </main>
  </div>

  <script src="app.js"></script>
  <script>
    window.app.requireAuth();
    (async () => {
      try {
        const data = await window.app.apiJson('/api/me');
        document.getElementById('username').textContent = data.username || '';
      } catch {
        document.getElementById('username').textContent = '';
      }
    })();
    const id = window.app.getQueryParam('no');
    if (!id) {
      alert('ID tidak ditemukan');
      window.location.href = 'data_barang.html';
    }

    async function loadBarcode() {
      const data = await window.app.apiJson(`/api/barang?id=${id}`);
      const text = data && data.kode_alat ? data.kode_alat : '';
      if (!text) {
        alert('Kode alat tidak ditemukan');
        return;
      }
      JsBarcode('#barcode', text, {
        format: 'CODE39',
        lineColor: '#000',
        width: 2,
        height: 80,
        displayValue: true
      });
    }

    loadBarcode().catch((err) => alert(err.message));
  </script>
</body>
</html>
