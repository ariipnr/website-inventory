<!DOCTYPE html>
<html>
<head>
  <title>Inventaris Barang</title>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.2/dist/css/bootstrap.min.css">
  <link rel="stylesheet" href="style.css">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Sora:wght@300;400;500;600;700&display=swap" rel="stylesheet">
</head>
<body class="dashboard-page">
  <div class="crm-shell">
    <aside class="crm-sidebar">
      <a class="crm-brand crm-brand__link" href="index.html">
        <img src="image/LogoIPB.png" alt="Logo IPB">
        <div>
          <h2>Inventory CRM</h2>
          <span>Lab Komputer</span>
        </div>
      </a>
      <nav class="crm-nav">
        <a class="crm-nav__link" href="dashboard.html">Beranda</a>
        <a class="crm-nav__link active" href="data_barang.html">Data Barang</a>
        <a class="crm-nav__link" href="pinjam_alat.html">Peminjaman</a>
        <a class="crm-nav__link" href="chart.html">Laporan</a>
        <a class="crm-nav__link" href="tentang_kami.html">Tentang Kami</a>
      </nav>
      <div class="crm-sidebar__footer">
        <span>Aktif sebagai</span>
        <strong id="username">-</strong>
        <button type="button" class="btn btn-outline-light btn-sm" onclick="window.app.logout()">Logout</button>
      </div>
    </aside>

    <main class="crm-main">
      <header class="crm-topbar">
        <div>
          <h1>Edit Barang</h1>
          <p>Perbarui data inventaris.</p>
        </div>
      </header>

      <section class="crm-panel">
        <form id="editBarangForm">
          <table width="500" align="center" border="0">
            <td>
          <input type="hidden" name="no" id="no">

          <label for="basic-url">Kode Alat</label>
          <div class="input-group mb-3">
            <input type="text" name="kd_alat" id="kd_alat" class="form-control" placeholder="Kode Alat">
          </div>

          <label for="basic-url">Serial Number</label>
          <div class="input-group mb-3">
            <input type="text" name="serial_number" id="serial_number" class="form-control" placeholder="Serial Number">
          </div>

          <label for="basic-url">Kategori</label>
          <div class="input-group mb-3">
            <select name="kategori" id="kategori" class="form-control" required>
              <option value="Network Device">Network Device</option>
              <option value="PC">PC</option>
              <option value="Sparepart">Sparepart</option>
              <option value="Printer">Printer</option>
              <option value="Alat">Alat</option>
              <option value="Lainnya">Lainnya</option>
            </select>
          </div>

          <label for="basic-url">Merek</label>
          <div class="input-group mb-3">
            <input type="text" name="merek" id="merek" class="form-control" placeholder="Merek">
          </div>

          <label for="basic-url">Nama Alat</label>
          <div class="input-group mb-3">
            <input type="text" name="nama_alat" id="nama_alat" class="form-control" placeholder="Nama Alat">
          </div>

          <label for="basic-url">Spesifikasi</label>
          <div class="input-group">
            <textarea class="form-control" cols="50" name="spek" id="spek" aria-label="With textarea"></textarea>
          </div>

          <label for="basic-url">Jumlah</label>
          <div class="input-group mb-3">
            <input type="text" name="jml" id="jml" class="form-control" placeholder="Jumlah">
          </div>
          <br>
          <div class="input-group mb-3">
            <button class="btn btn-primary btn-flat btn-block">Simpan</button>
          </div>
            </td>
          </table>
        </form>
      </section>
    </main>
  </div>

  <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.2/dist/js/bootstrap.min.js"></script>
  <script src="app.js"></script>
  <script>
    window.app.requireAuth();
    (async () => {
      try {
        const data = await window.app.apiJson('/api/me');
        document.getElementById('username').textContent = data.username || '';
      } catch {
        document.getElementById('username').textContent = '';
      }
    })();
    const id = window.app.getQueryParam('no');
    if (!id) {
      alert('ID tidak ditemukan');
      window.location.href = 'data_barang.html';
    }

    async function loadItem() {
      const data = await window.app.apiJson(`/api/barang?id=${id}`);
      if (!data) {
        alert('Data tidak ditemukan');
        window.location.href = 'data_barang.html';
        return;
      }
      document.getElementById('no').value = data.no;
      document.getElementById('kd_alat').value = data.kode_alat || '';
      document.getElementById('serial_number').value = data.serial_number || '';
      document.getElementById('kategori').value = data.kategori || '';
      document.getElementById('merek').value = data.merek || '';
      document.getElementById('nama_alat').value = data.nama_alat || '';
      document.getElementById('spek').value = data.spesifikasi || '';
      document.getElementById('jml').value = data.jumlah || '';
    }

    document.getElementById('editBarangForm').addEventListener('submit', async (e) => {
      e.preventDefault();
      const formData = new FormData(e.target);
      const payload = Object.fromEntries(formData.entries());
      try {
        await window.app.apiJson(`/api/barang?id=${id}`, {
          method: 'PUT',
          body: JSON.stringify(payload)
        });
        window.location.href = 'data_barang.html';
      } catch (err) {
        alert(err.message);
      }
    });

    loadItem().catch((err) => alert(err.message));
  </script>
</body>
</html>
